k
server {
    listen 0.0.0.0:8080;
    server_name www.laaroubi.com;
    client_max_body_size 10M;

    # --- Error Pages ---

    error_page 404 /errors/404.html;
    error_page 403 /errors/403.html;
    error_page 500 /errors/500.html;
    error_page 502 /errors/502.html;
    error_page 504 /errors/504.html;
    error_page 400 /errors/400.html;
    error_page 405 /errors/405.html;

    # --- Main Location ---

    location / {
        root ./www;
        index index.html;
        allow_methods GET POST DELETE;
        autoindex on;
        auth_required off;
    }

    # --- Images Location ---

    location /images/ {
        root ./www;
        allow_methods GET;
        autoindex on;
    }

    # --- Uploads Location ---

    location /uploads {
        root ./www; # This root is for serving a response page (e.g., "Upload successful!")
        allow_methods POST GET;
        upload_path ./www/uploads/; # This tells your POST logic where to store the file.
        autoindex off;
    }

    # --- Cgi Scripts ---

    location /cgi-bin/php/ {
        root ./;
        allow_methods GET POST ;
        index phpTest.php;
        cgi_pass .php /usr/bin/php-cgi;
    }

    location /cgi-bin/python/ {
        root ./cgi-bin/python/;
        allow_methods GET POST ;
        index pyTest.py;
        cgi_pass .py /usr/bin/python3;
    }


    # ====================================================================
    # --- NEW TEST LOCATIONS ---
    # ====================================================================

    # --- 1. Test for HTTP Redirection ---
    # A request to /redirect should permanently move the user to Google.
    # How to test: Visit http://127.0.0.1:8080/redirect in your browser.
    # Expected behavior: Your browser should be redirected to https://www.google.com.
    # Your server should send back a 301 status code.
    location /301redirect/ {
        return 301 /301redirect.html;
    }
    location /302redirect/ {
        return 302 /302redirect.html;
    }

    # --- 2. Test for Method Limiting ---
    # This location only allows the GET method.
    # How to test:
    #   - GET (should work): curl http://127.0.0.1:8080/secret/
    #   - POST (should fail): kitaydiro i testiw post b curl
    # Expected behavior: The POST request should be rejected with a 405 Method Not Allowed error.
    location /secret/ {
        root ./www;
        index secret.html;
        allow_methods GET;
    }

    # --- 3. Test for Disabling Directory Listing ---
    # This directory has autoindex turned off.
    # How to test: Visit http://127.0.0.1:8080/no-listing/
    # (Make sure the directory www/no-listing/ exists but has NO index file in it).
    # Expected behavior: You should get a 403 Forbidden error, not a list of files.
    location /noListing/ {
        root ./www;
        allow_methods GET;
        autoindex off;
    }

    # --- 4. Test for Cookies and Sessions (Bonus) ---
    # This location points to a special CGI script for testing session management.
    # How to test: Visit http://127.0.0.1:8080/cgi-bin/session_test.py
    # Expected behavior: The Python script should be able to set a cookie on the first
    # visit and read it back on subsequent visits.
    # location /cgi-bin/session_test.py {
    #     root ./;
    #     allow_methods GET POST;
    #     cgi_pass .py /usr/bin/python3;
    # }

    # --- CGI Location ---
    # This is for running scripts. The root is now the cgi-bin directory.
    # This is more secure as it's outside the public www folder.
    # location /cgi-bin/ {
    #     root ./cgi-bin;
    #     allow_methods GET POST;
    #     # Example for PHP
    #     cgi_pass .php /usr/bin/php-cgi;
    #     # Example for Python
    #     cgi_pass .py /usr/bin/python3;
    # }
}
